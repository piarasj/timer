<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Segment Timer</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: -apple-system, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100dvh; /* fixes iOS Safari centering */
    }
    #clock {
      width: 300px;
      height: 300px;
    }
    #controls {
      margin-top: 1.5rem;
    }
    button {
      padding: 0.75rem 1.5rem;
      font-size: 1.1rem;
      border: none;
      border-radius: 0.75rem;
      margin: 0 0.5rem;
      cursor: pointer;
      background: #22c55e;
      color: white;
    }
    button.stop {
      background: #ef4444;
    }
    #ack {
      margin-top: 1rem;
      font-size: 1.2rem;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <canvas id="clock"></canvas>

  <div id="controls">
    <button id="startBtn">Start</button>
    <button id="stopBtn" class="stop">Stop</button>
  </div>

  <div id="ack"></div>

<script>
let settings;
let running = false;
let timerInterval;

// Load settings.json
async function loadSettings() {
  const res = await fetch("settings.json");
  settings = await res.json();
  drawClock(); // initial render
}

// Draw clock face + arcs
function drawClock() {
  const canvas = document.getElementById("clock");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // clock face
  ctx.fillStyle = "black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // segments
  if (settings && settings.segments) {
    settings.segments.forEach((seg,i) => {
      const startAngle = (Math.PI/180) * seg.startAngle;
      const endAngle = startAngle + (2 * Math.PI) * (seg.duration/3600); 
      // seg.duration is in seconds, convert to portion of clock (3600 sec = full circle)

      ctx.beginPath();
      ctx.moveTo(canvas.width/2, canvas.height/2);
      ctx.arc(canvas.width/2, canvas.height/2, 140, startAngle, endAngle, false);
      ctx.closePath();
      ctx.fillStyle = `hsl(${i*60}, 80%, 50%)`;
      ctx.fill();
    });
  }
}

// Start / Stop
function startTimer() {
  if (running) return;
  running = true;

  const ack = document.getElementById("ack");
  ack.textContent = "Started at " + settings.autoStart;

  let startTime = Date.now();
  timerInterval = setInterval(() => {
    // could update live countdown here
    drawClock();
  }, 1000);
}

function stopTimer() {
  if (!running) return;
  running = false;
  clearInterval(timerInterval);
  document.getElementById("ack").textContent = "Stopped.";
}

// Wire up buttons
document.getElementById("startBtn").addEventListener("click", startTimer);
document.getElementById("stopBtn").addEventListener("click", stopTimer);

loadSettings();
</script>
</body>
</html>